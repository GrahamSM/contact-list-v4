
<div class="container" id="title-container">
  <h1 class="title">Contact List</h1>
</div>
<div class="container">
  <div id="btn-list">
    <form>
      <button type="button" class="btn btn-raised btn-primary">List</button>
    </form>
  </div>
  <div id="btn-number">
    <form>
      <button type="button" class="btn btn-raised btn-primary">Number</button>
    </form>
  </div>
  <div id="btn-new">
      <button type="button" class="btn btn-raised btn-primary">New</button>
  </div>
  <div id="btn-show">
    <form>
      <button type="button" class="btn btn-raised btn-primary">Show</button>
    </form>
  </div>
  <div id="btn-update">
    <form>
      <button type="button" class="btn btn-raised btn-primary">Update</button>
    </form>
  </div>
  <div id="btn-destroy">
    <form>
      <button type="button" class="btn btn-raised btn-primary">Destroy</button>
    </form>
  </div>
</div>




<form class="new-contact-form" id = "default-form" action="/contact/new" method="post">
    <input id="first_name" type="text" name="first" placeholder="First Name"><br>
    <input id="last_name" type="text" name="last" placeholder="Last Name"><br>
    <input id="number" type="text" name="number" placeholder="Phone Number"><br>
    <input id="email" type="text" name="email" placeholder="Email"><br>
    <input type="submit" value="Submit">
</form>



<form class="show-contact-form" id = "default-form" action="/contact/show" method="post">
    <input id="contact_id" type="text" name="contact_id" placeholder="Contact ID"><br>
    <input type="submit" value="Submit">
</form>


<div class="bottom-div">
</div>

<script id="show-template" type="text/x-handlebars-template">
  <div class="display-contact">
    <div class="display-contact-inner">
    <h2 id="contact-name">{{first_name}} {{last_name}}</h2>
    <p id="contact-email">{{email}}</p>
    <p id="contact-primary">{{number}}</p>
    <button type="button" class="btn btn-raised btn-primary" id="hide-contact-button">Hide</button>
    </div>
  </div>
</script>

<script id="list-template" type="text/x-handlebars-template">
  <div class="display-contact">
    <div class="display-contact-inner">
      <h2 id="contact-name">{{first_name}} {{last_name}}</h2>
      <p id="contact-email">{{email}}</p>
      <p id="contact-primary">{{number}}</p>
    </div>
  </div>
</script>

<script>
var num_list_calls = 0;
$('.new-contact-form').hide();
$('.show-contact-form').hide();
$('.display-contact').hide();
$('.bottom-div').hide(); //    TODO:IMPROVE???!


function contactFormPathOnly(path_url){
  $('.new-contact-form').slideToggle();
  $('.new-contact-form').on('submit', function(event) {
    event.preventDefault();
    var form = $(this);
    $.ajax({
      url: path_url,
      type: 'POST',
      data: form.serialize()
    }).done(function(response_data) {
      $('.new-contact-form').slideUp(); //TODO: WHY ARENT WE HITTING THIS?!?!?!?
    })
  })
}

function contactFormUpdate(path_url, id){
  $('.new-contact-form').slideToggle();
  $('.new-contact-form').on('submit', function(event) {

    event.preventDefault();
    $.ajax({
      url: path_url,
      type: 'POST',
      data: {form_data: form.serialize(), contact_id: id}
    }).done(function(response_data) {
      $('.new-contact-form').slideUp();
    })
  })
}

$("#btn-new").on('click', function(e) {
  contactFormPathOnly('/contact/new')
});

$("#btn-show").on('click', function(e) {
  $('.bottom-div').empty();
  $('.show-contact-form').slideToggle();
  $('.show-contact-form').on('submit', function(event) {
    var target = $(event.target);
    var form = target.closest('form');
    event.preventDefault();
    $.ajax({
      url: form.attr('action'),
      type: 'GET',
      data: form.serialize()
    }).done(function(response_data) {
      var source = $("#show-template").html();
      var template = Handlebars.compile(source);
      var context = {first_name: response_data.contact.first_name, last_name: response_data.contact.last_name, email: response_data.contact.email};
      var html = template(context);
      $('.bottom-div').append(html);
      $('.show-contact-form').slideUp();
      $('.bottom-div').slideDown();
      // $('.display-contact #contact-name').html(response_data.contact.first_name);
      // $('.display-contact #contact-email').html(response_data.contact.email);
      // $('.display-contact').slideDown();
    });
  });
});

$("#btn-update").on('click', function(e) {
  $('.show-contact-form').slideToggle();
  $('.show-contact-form').on('submit', function(event) {
    var target = $(event.target);
    var form = target.closest('form');
    event.preventDefault();
    $.ajax({
      url: form.attr('action'),
      type: 'GET',
      data: form.serialize()
    }).done(function(response_data) {
      $('.show-contact-form').slideUp();
      var path_url = '/contact/update';
      contactFormUpdate(path_url, response_data.contact.id);
    })
  });
});


$("#btn-list").on('click', function(e) {
  if (num_list_calls%2==0){
    $('.bottom-div').slideDown(); //
  }
  else{
    $('.bottom-div').slideUp(); //
  }
  num_list_calls += 1;
  $.ajax({
    url: '/contacts/all',
    type: 'GET'
  }).done(function(response_data) {
    for (var i = 0; i < response_data.contacts.length; i++){
      var source   = $("#list-template").html();
      var template = Handlebars.compile(source);
      var context = {first_name: response_data.contacts[i].first_name, last_name: response_data.contacts[i].last_name, email: response_data.contacts[i].email};
      var html = template(context);
      $('.bottom-div').append(html); //    TODO:IMPROVE???!
    }
  })
});


$(document).on("click", "#hide-contact-button", function(){
  $('.bottom-div').slideUp();
})

</script>

<script src="//cdnjs.cloudflare.com/ajax/libs/handlebars.js/1.3.0/handlebars.min.js"></script>
